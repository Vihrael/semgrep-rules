rules:
- id: sqlalchemy-orderby-sql-injection
  patterns:
  - pattern-either:
    - pattern: |
        def $FUNC(...,$VAR,...):
          ...
          $SESSION.query(...).order_by("...".format(...,$VAR,...))
    - pattern: |
        def $FUNC(...,$VAR,...):
          ...
          $SESSION.query.join(...).order_by("...".format(...,$VAR,...))
    - pattern: |
        def $FUNC(...,$VAR,...):
          ...
          $SESSION.query.order_by("...".format(...,$VAR,...))
    - pattern: |
        def $FUNC(...,$VAR,...):
          ...
          query.order_by("...".format(...,$VAR,...))
  message: |
    Order_by in SQLAlchemy can cause sql injections if the developer inputs raw SQL into the filter clause. 
    This pattern captures relevant cases in which the developer inputs raw SQL into the order_by parameter and 
    injects user-input into the raw SQL with "format". Instead, use bindParams to securely bind user-input
    to SQL statements.
  fix-regex:
    regex: format
    replacement: bindparams
  language:
  - python
  severity: WARNING

